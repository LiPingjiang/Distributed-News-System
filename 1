<!DOCTYPE html>
<html>
	<head>
		<script>
			readNews();


			function readNews(){
				if (window.XMLHttpRequest) {
					// code for IE7+, Firefox, Chrome, Opera, Safari
	  				xmlhttp = new XMLHttpRequest();
	  			} else {
	    				// code for IE6, IE5
					xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
	  			}
	  			xmlhttp.onreadystatechange = function() {
	  				if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
	  					document.getElementById("txtNews").innerHTML = xmlhttp.responseText;
	  				}
	  			};
				xmlhttp.open("GET","http://localhost/table.php?TYPE=GET",true);
				xmlhttp.send();
			}

			//Used for synchronizing news on replica nodes' database
			function syncNews(){
				
			}

			//Using RabbitMQ to send log information
			function globleLog(){
				
			}
			function updateNews(){
				if (window.XMLHttpRequest) {
					// code for IE7+, Firefox, Chrome, Opera, Safari
	  				xmlhttp = new XMLHttpRequest();
	  			} else {
	    				// code for IE6, IE5
					xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
	  			}
	  			xmlhttp.onreadystatechange = function() {
	  				if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
	  					//document.getElementById("txtNews").innerHTML = xmlhttp.responseText;
	  					alert('Successed Added');
						readNews();
						syncNews();
						globleLog();
					}else{
						//alert(xmlhttp.readyState);
					}
	  			};

				var e = document.getElementById('newsType');
				var newsType = e.options[e.selectedIndex].value;

				var news = document.getElementById('news').value;
				xmlhttp.open("GET","http://localhost/table.php?TYPE=UPDATE&Type="+newsType+"&News="+news,true);
				xmlhttp.send();
			
			}
		</script>
	</head>
	<body>


		News:<br>
		<input type="text" name="news" id="news" value="News">
		<br>
		News Type:<br>
		<select id="newsType">
			<option value="public">Public</option>
			<option value="private">Private</option>
		</select> 
		<br><br>
		<input type="button" value="Submit" onclick="updateNews()">

		<br><br>
		<div id="txtNews"></div>
		
		<!--RabbitMQ connection -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
		<script src="stomp.js"></script>
		<script type="text/javascript">

			

			$(document).ready(function(){
				//$(window).on('beforeunload', function(){
	    			//	socket.close();
				//});
				var client, destination;
				var url = 'ws://localhost:15674/stomp/websocket';
				var login = 'ds';
				var passcode = 'abcd1234';
				destination = '/exchange/distributedsystem';

				client = Stomp.client(url);

				// this allows to display debug logs directly on the web page
				client.debug = function(str) {
					$("#debug").append(str + "\n");
				};
				// the client is notified when it is connected to the server.
				client.connect(login, passcode, function(frame) {
					client.subscribe(destination, function(message) {
					//call-back function after receive new message can process here
					});
				});
				function RabbitMQ_send(message_type,message){
					client.send(destination, {type:message_type}, message);
				};
				
			});
		</script>
	</body>
</html>

